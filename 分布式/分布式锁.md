#### 分布式锁的实现方式:

1、基于数据库表实现：锁表、版本号乐观锁。适用并发低，性能要求不高的情况。

2、基于分布式缓存：redis。适用高并发、高性能场景。

3、基于zk、etcd实现：除了对性能要求极高，适用大部分场景。

#### 设计分布式锁：

**事前-技术评审**：预估业务环节风险点，确定选型合理性

* 数据库表：乐观锁适用于单行数据，读多写少。
* ZK：实现复杂
* redis：适用大部分业务场景

**事中-codeReview**：

* redis：setnx+try/finally
* 数据库表：
  * 版本号乐观锁：version字段，先读取然后写入的时候再次读取比较两次是否一致
  * 锁行：不推荐

**事后-保障**：

* 对账系统：流水表；账户表；流水和账户明细进行比较